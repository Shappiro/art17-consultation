{% extends layout_template %}

{% block content %}

  <p>Choose a group and then a country. Optionally, further refine your query
  by selecting one of the available biogeographical regions for that
  country.</p>
  <p><strong>NOTE:</strong> Texts in blue shows relevant information on mouse
  over and rows in italic shows data not taken into account when performing the
  assessments (marginal presence, occasional, extinct prior HD, information,
  etc)</p>
  {% include 'report/filters.html' %}

  {% if current_selection %}

    {% include 'common/table_legend.html' %}

    {% set colspan_all=35 if region else 36 %}

    <table class="complex_datatable datatable">
      <caption>
        <b>Current selection</b>:
        {{ current_selection|join(', ') }}.
      </caption>

      <colgroup>
        <col span="1" class="col_border_right">{% if not region %}
        <col span="1" class="col_border_right">{% endif %}
        {# Range #}
        <col span="1" class="col_border_left">
        <col span="2">
        <col span="1" class="col_border_right">

        {# Population #}
        <col span="1" class="col_border_left">
        <col span="2">
        <col span="1" class="col_border_right">
        {# Habitat #}
        <col span="1" class="col_border_left">
        <col span="3">
        <col span="1" class="col_border_right">
        {# FP #}
        <col span="1" class="col_border">
        {# Overall ass. #}
        <col span="1" class="col_border_left">
        <col span="2">
        <col span="1" class="col_border_right">
        {# Grided maps #}
        <col span="1" class="col_border_left">
        <col span="2">
        <col span="1" class="col_border_right">
        {# Comments #}
        <col span="1" class="col_border_left">
        <col span="3">
        <col span="1" class="col_border_right">
      </colgroup>

      {% include "common/species_table_header.html" with context %}

      <tbody>

        {% for row in objects %}
          {% set visible = can_view(row, restricted_countries) %}
          {% set qa_errors = record_errors(row) %}
          <tr {% if row.is_assesm %}class="assesm"{% endif %}>
            <td>
              {% set original_url=get_original_record_url(row) %}
              <a class="popup-btn" data-title="Factsheet" href="{{ original_url }}">
                {{ row.subject }}
              </a>
            </td>

            {% if not country %}<td>{{ row.eu_country_code }}</td>{% endif %}

            {% if not region %}
              <td><a href="#map">{{ row.region }}</a></td>
            {% endif %}

            {% if not visible %}
            <td colspan="2">
              {{ row.eu_country_code }} has provided a report to the European Commission under Article 17
            </td>
            {% else %}

              {% include 'summary/species/content/range.html' with context %}
              {% include 'summary/species/content/population.html' with context %}
              {% include 'summary/species/content/habitat.html' with context %}
              {% include 'summary/species/content/future_prospects.html' with context %}
              {% include 'summary/common/content/overall_assessment.html' with context %}
              {% include 'summary/species/content/grided_maps.html' with context %}

              <td colspan="5">{# Padding #}</td>
            {% endif %}
          </tr>
        {% endfor %}

      </tbody>

    </table>
  {% else %}
    <p><b>Please select a group.</b></p>
  {% endif %}

{% endblock %}
